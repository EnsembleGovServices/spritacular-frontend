"use strict";(self.webpackChunkspritacular_frontend=self.webpackChunkspritacular_frontend||[]).push([[782],{52334:function(n,e,t){t.r(e),t.d(e,{default:function(){return Z}});var o=t(74165),i=t(1413),s=t(15861),a=t(70885),l=t(72791),r=t(74551),c=t(94677),u=t(72426),d=t.n(u),m=t(17834),v=t(7788),f=t(62711),h=t(40872),x=t(47604),p=t(80184),g=function(){return(0,p.jsx)("div",{className:"no-comments",children:(0,p.jsxs)("div",{className:"no-com-content",children:[(0,p.jsx)("img",{className:"img-fluid",src:x.Z.commentImage,alt:"noComments"}),(0,p.jsx)("h4",{className:"title",children:"No comments yet"}),(0,p.jsx)("p",{className:"text",children:"Be the first to comment on this observation."})]})})},j=t(76113),b=t(93754),N=function(){var n=(0,l.useState)(!1),e=(0,a.Z)(n,2),t=e[0],o=e[1],i=(0,l.useState)(!1),s=(0,a.Z)(i,2),r=s[0],c=s[1],u=function(){o(!t),c(!1)},d=function(){c(!r)};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"not-logged-for-comment",children:(0,p.jsxs)("div",{className:"nlfc-content",children:[(0,p.jsx)("img",{className:"img-fluid",src:x.Z.notLoggedIn,alt:"noComments"}),(0,p.jsx)("h6",{className:"title",children:"You need to be logged in for commenting on this observation"}),(0,p.jsxs)("div",{className:"mt-4 btn-wrap",children:[(0,p.jsx)("button",{onClick:function(){return u()},type:"button",className:"btn btn-outline-primary px-4 my-2",children:"Login"}),(0,p.jsx)("button",{onClick:function(){return d()},type:"button",className:"btn btn-primary px-4 my-2 ms-3",children:"Register"})]})]})}),t&&(0,p.jsx)(j.Z,{open:t,handleClose:u}),r&&(0,p.jsx)(b.Z,{open:r,handleClose:d,handleLoginModal:u,modalClass:"registerModal"})]})},Z=function(n){var e,t,u=(0,m.Z)().auth,j=n.obvId,b=(0,l.useState)([]),Z=(0,a.Z)(b,2),w=Z[0],C=Z[1],_=(0,l.useState)(),y=(0,a.Z)(_,2),k=y[0],S=y[1],M=(0,l.useState)(!1),D=(0,a.Z)(M,2),E=D[0],I=D[1],L=(0,l.useRef)(null),z=(0,h.Z)(),B=z.observationComments,F=z.setObservationComments,O=null===u||void 0===u||null===(e=u.user)||void 0===e?void 0:e.id,P=null===B||void 0===B||null===(t=B.comments)||void 0===t?void 0:t.length,R=function(){var n=(0,s.Z)((0,o.Z)().mark((function n(){return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c.Z.get(r.v2.api+"/observation/comment/"+j+"/").then((function(n){C(null===n||void 0===n?void 0:n.data),F((function(e){var t;return(0,i.Z)((0,i.Z)({},e),{},{comments:null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.data})}))})).catch((function(n){console.log(n)}));case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),A=function(){var n=(0,s.Z)((0,o.Z)().mark((function n(e){var t;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.preventDefault(),I(!1),n.next=4,c.Z.post(r.v2.api+"/observation/comment/"+j+"/",{text:k},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null===u||void 0===u||null===(t=u.token)||void 0===t?void 0:t.access)}}).then((function(n){I(!0),L.current.value="",S("")})).catch((function(n){I(!0)}));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,l.useEffect)((function(){O&&(L.current.focus=!0,R().then((function(n){return n})))}),[E]),(0,l.useEffect)((function(){F((function(n){var e;return(0,i.Z)((0,i.Z)({},n),{},{comment_count:null!==w&&void 0!==w&&w.data?null===w||void 0===w||null===(e=w.data)||void 0===e?void 0:e.length:0})}))}),[w]),(0,l.useEffect)((function(){R().then((function(n){return n}))}),[]),(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{className:"comment-wrapper position-relative ".concat(O?"":"non-logged"),children:[!O&&(0,p.jsx)("div",{className:"p-0 m-0 ".concat(P?"hasComments":"hasNoComments"),children:(0,p.jsx)(N,{})}),P?(0,p.jsx)("ul",{className:"comment-area not-logged-list p-0 m-0",children:function(){var n;return null===B||void 0===B||null===(n=B.comments)||void 0===n?void 0:n.filter((function(n){return null===n||void 0===n?void 0:n.is_active})).map((function(n,e){var t,o,i,s;return(0,p.jsxs)("li",{className:"d-flex align-items-center w-100",children:[(0,p.jsx)("i",{className:"profile-icon rounded-circle me-0",children:(0,p.jsx)("img",{src:null!==n&&void 0!==n&&null!==(t=n.user_data)&&void 0!==t&&t.profile_image?null===n||void 0===n||null===(o=n.user_data)||void 0===o?void 0:o.profile_image:x.Z.DefaultProfile,width:"100%",height:"100%",alt:"Profile",className:"rounded-circle"})}),(0,p.jsxs)("div",{className:"commentor_details d-flex justify-content-between align-items-start",children:[(0,p.jsxs)("div",{className:"comment-profile_details",children:[(0,p.jsxs)("h6",{className:"mb-1 text-truncate text-black",children:[null===n||void 0===n||null===(i=n.user_data)||void 0===i?void 0:i.first_name," ",null===n||void 0===n||null===(s=n.user_data)||void 0===s?void 0:s.last_name]}),(0,p.jsx)("p",{className:"mb-0 fw-normal",children:null===n||void 0===n?void 0:n.text})]}),(0,p.jsx)("span",{className:"comment-time fw-normal",children:d()("".concat(null===n||void 0===n?void 0:n.created_on)).format("DD-MMM")})]})]},e)}))}()}):!P&&O?(0,p.jsx)("ul",{className:"comment-area p-0 m-0",children:(0,p.jsx)(g,{})}):"",O&&(0,p.jsx)("form",{onSubmit:A,children:(0,p.jsxs)(v.cw,{className:"typing-area d-flex justify-content-between align-items-center start-0 bottom-0",children:[(0,p.jsx)("input",{className:"form-control",type:"text",name:"text",ref:L,placeholder:"Write here..",onChange:function(n){return function(n){var e=n.target.value;S(e)}(n)}}),(0,p.jsx)(v.zx,{disabled:0===(null===k||void 0===k?void 0:k.length),className:"send-btn shadow-none border-0 position-absolute end-0 pe-3",children:(0,p.jsx)(f.JO,{icon:"bi:send",color:0===(null===k||void 0===k?void 0:k.length)?"#ccc":"#900"})})]})})]})})}}}]);
//# sourceMappingURL=782.9d6a8062.chunk.js.map