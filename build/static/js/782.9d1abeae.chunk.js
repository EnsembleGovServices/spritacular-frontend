"use strict";(self.webpackChunkspritacular_frontend=self.webpackChunkspritacular_frontend||[]).push([[782],{52334:function(n,e,t){t.r(e),t.d(e,{default:function(){return w}});var o=t(1413),i=t(15861),s=t(70885),a=t(87757),l=t.n(a),r=t(72791),c=t(74551),u=t(94677),d=t(72426),m=t.n(d),v=t(17834),f=t(7788),h=t(62711),x=t(40872),p=t(47604),g=t(80184),j=function(){return(0,g.jsx)("div",{className:"no-comments",children:(0,g.jsxs)("div",{className:"no-com-content",children:[(0,g.jsx)("img",{className:"img-fluid",src:p.Z.commentImage,alt:"noComments"}),(0,g.jsx)("h4",{className:"title",children:"No comments yet"}),(0,g.jsx)("p",{className:"text",children:"Be the first to comment on this observation."})]})})},b=t(76113),N=t(93754),Z=function(){var n=(0,r.useState)(!1),e=(0,s.Z)(n,2),t=e[0],o=e[1],i=(0,r.useState)(!1),a=(0,s.Z)(i,2),l=a[0],c=a[1],u=function(){o(!t),c(!1)},d=function(){c(!l)};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"not-logged-for-comment",children:(0,g.jsxs)("div",{className:"nlfc-content",children:[(0,g.jsx)("img",{className:"img-fluid",src:p.Z.notLoggedIn,alt:"noComments"}),(0,g.jsx)("h6",{className:"title",children:"You need to be logged in for commenting on this observation"}),(0,g.jsxs)("div",{className:"mt-4 btn-wrap",children:[(0,g.jsx)("button",{onClick:function(){return u()},type:"button",className:"btn btn-outline-primary px-4 my-2",children:"Login"}),(0,g.jsx)("button",{onClick:function(){return d()},type:"button",className:"btn btn-primary px-4 my-2 ms-3",children:"Register"})]})]})}),t&&(0,g.jsx)(b.Z,{open:t,handleClose:u}),l&&(0,g.jsx)(N.Z,{open:l,handleClose:d,handleLoginModal:u,modalClass:"registerModal"})]})},w=function(n){var e,t,a=(0,v.Z)().auth,d=n.obvId,b=(0,r.useState)([]),N=(0,s.Z)(b,2),w=N[0],C=N[1],_=(0,r.useState)(),y=(0,s.Z)(_,2),k=y[0],S=y[1],M=(0,r.useState)(!1),D=(0,s.Z)(M,2),E=D[0],I=D[1],L=(0,r.useRef)(null),z=(0,x.Z)(),B=z.observationComments,F=z.setObservationComments,O=null===a||void 0===a||null===(e=a.user)||void 0===e?void 0:e.id,P=null===B||void 0===B||null===(t=B.comments)||void 0===t?void 0:t.length,R=function(){var n=(0,i.Z)(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.Z.get(c.v2.api+"/observation/comment/"+d+"/").then((function(n){C(null===n||void 0===n?void 0:n.data),F((function(e){var t;return(0,o.Z)((0,o.Z)({},e),{},{comments:null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.data})}))})).catch((function(n){console.log(n)}));case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),A=function(){var n=(0,i.Z)(l().mark((function n(e){var t;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.preventDefault(),I(!1),n.next=4,u.Z.post(c.v2.api+"/observation/comment/"+d+"/",{text:k},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null===a||void 0===a||null===(t=a.token)||void 0===t?void 0:t.access)}}).then((function(n){I(!0),L.current.value="",S("")})).catch((function(n){I(!0)}));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,r.useEffect)((function(){O&&(L.current.focus=!0,R().then((function(n){return n})))}),[E]),(0,r.useEffect)((function(){F((function(n){var e;return(0,o.Z)((0,o.Z)({},n),{},{comment_count:null!==w&&void 0!==w&&w.data?null===w||void 0===w||null===(e=w.data)||void 0===e?void 0:e.length:0})}))}),[w]),(0,r.useEffect)((function(){R().then((function(n){return n}))}),[]),(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("div",{className:"comment-wrapper position-relative ".concat(O?"":"non-logged"),children:[!O&&(0,g.jsx)("div",{className:"p-0 m-0 ".concat(P?"hasComments":"hasNoComments"),children:(0,g.jsx)(Z,{})}),P?(0,g.jsx)("ul",{className:"comment-area not-logged-list p-0 m-0",children:function(){var n;return null===B||void 0===B||null===(n=B.comments)||void 0===n?void 0:n.filter((function(n){return null===n||void 0===n?void 0:n.is_active})).map((function(n,e){var t,o,i,s;return(0,g.jsxs)("li",{className:"d-flex align-items-center w-100",children:[(0,g.jsx)("i",{className:"profile-icon rounded-circle me-0",children:(0,g.jsx)("img",{src:null!==n&&void 0!==n&&null!==(t=n.user_data)&&void 0!==t&&t.profile_image?null===n||void 0===n||null===(o=n.user_data)||void 0===o?void 0:o.profile_image:p.Z.DefaultProfile,width:"100%",height:"100%",alt:"Profile",className:"rounded-circle"})}),(0,g.jsxs)("div",{className:"commentor_details d-flex justify-content-between align-items-start",children:[(0,g.jsxs)("div",{className:"comment-profile_details",children:[(0,g.jsxs)("h6",{className:"mb-1 text-truncate text-black",children:[null===n||void 0===n||null===(i=n.user_data)||void 0===i?void 0:i.first_name," ",null===n||void 0===n||null===(s=n.user_data)||void 0===s?void 0:s.last_name]}),(0,g.jsx)("p",{className:"mb-0 fw-normal",children:null===n||void 0===n?void 0:n.text})]}),(0,g.jsx)("span",{className:"comment-time fw-normal",children:m()("".concat(null===n||void 0===n?void 0:n.created_on)).format("DD-MMM")})]})]},e)}))}()}):!P&&O?(0,g.jsx)("ul",{className:"comment-area p-0 m-0",children:(0,g.jsx)(j,{})}):"",O&&(0,g.jsx)("form",{onSubmit:A,children:(0,g.jsxs)(f.cw,{className:"typing-area d-flex justify-content-between align-items-center start-0 bottom-0",children:[(0,g.jsx)("input",{className:"form-control",type:"text",name:"text",ref:L,placeholder:"Write here..",onChange:function(n){return function(n){var e=n.target.value;S(e)}(n)}}),(0,g.jsx)(f.zx,{disabled:0===(null===k||void 0===k?void 0:k.length),className:"send-btn shadow-none border-0 position-absolute end-0 pe-3",children:(0,g.jsx)(h.JO,{icon:"bi:send",color:0===(null===k||void 0===k?void 0:k.length)?"#ccc":"#900"})})]})})]})})}}}]);
//# sourceMappingURL=782.9d1abeae.chunk.js.map