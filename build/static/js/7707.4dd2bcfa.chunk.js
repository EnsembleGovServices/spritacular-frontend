"use strict";(self.webpackChunkspritacular_frontend=self.webpackChunkspritacular_frontend||[]).push([[7707],{77707:function(e,n,t){t.r(n),t.d(n,{default:function(){return b}});var o=t(1413),i=t(15861),r=t(70885),a=t(87757),l=t.n(a),c=t(72791),s=t(74551),u=t(94677),d=t(72426),v=t.n(d),m=t(17834),f=t(7788),h=t(62711),p=t(40872),x=t(92927),j=t(80184),b=function(e){var n,t,a=(0,m.Z)().auth,d=e.obvId,b=(0,c.useState)([]),g=(0,r.Z)(b,2),w=g[0],N=g[1],_=(0,c.useState)(),Z=(0,r.Z)(_,2),k=Z[0],y=Z[1],C=(0,c.useState)(!1),D=(0,r.Z)(C,2),S=D[0],z=D[1],E=(0,c.useRef)(null),M=(0,p.Z)(),A=M.observationComments,B=M.setObservationComments,O=null===a||void 0===a||null===(n=a.user)||void 0===n?void 0:n.id,P=function(){var e=(0,i.Z)(l().mark((function e(){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!O){e.next=3;break}return e.next=3,u.Z.get(s.v2.api+"/observation/comment/"+d+"/",{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null===a||void 0===a||null===(n=a.token)||void 0===n?void 0:n.access)}}).then((function(e){N(null===e||void 0===e?void 0:e.data),B((function(n){var t;return(0,o.Z)((0,o.Z)({},n),{},{comments:null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data})}))})).catch((function(e){console.log(e)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,i.Z)(l().mark((function e(n){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),z(!1),e.next=4,u.Z.post(s.v2.api+"/observation/comment/"+d+"/",{text:k},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null===a||void 0===a||null===(t=a.token)||void 0===t?void 0:t.access)}}).then((function(e){z(!0),E.current.value="",y("")})).catch((function(e){z(!0)}));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){O&&(E.current.focus=!0,P().then((function(e){return e})))}),[S]),(0,c.useEffect)((function(){B((function(e){var n;return(0,o.Z)((0,o.Z)({},e),{},{comment_count:null!==w&&void 0!==w&&w.data?null===w||void 0===w||null===(n=w.data)||void 0===n?void 0:n.length:0})}))}),[w]);return(0,c.useEffect)((function(){P().then((function(e){return e}))}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("div",{className:"comment-wrapper position-relative",children:[(0,j.jsx)("ul",{className:"comment-area p-0 m-0",children:null!==A&&void 0!==A&&null!==(t=A.comments)&&void 0!==t&&t.length?function(){var e;return null===A||void 0===A||null===(e=A.comments)||void 0===e?void 0:e.filter((function(e){return null===e||void 0===e?void 0:e.is_active})).map((function(e,n){var t,o,i,r;return(0,j.jsxs)("li",{className:"d-flex align-items-center w-100",children:[(0,j.jsx)("i",{className:"profile-icon rounded-circle me-0",children:(0,j.jsx)("img",{src:null!==e&&void 0!==e&&null!==(t=e.user_data)&&void 0!==t&&t.profile_image?null===e||void 0===e||null===(o=e.user_data)||void 0===o?void 0:o.profile_image:x.Z.DefaultProfile,width:"100%",height:"100%",alt:"Profile",className:"rounded-circle"})}),(0,j.jsxs)("div",{className:"commentor_details d-flex justify-content-between align-items-start",children:[(0,j.jsxs)("div",{className:"comment-profile_details",children:[(0,j.jsxs)("h6",{className:"mb-1 text-truncate text-black",children:[null===e||void 0===e||null===(i=e.user_data)||void 0===i?void 0:i.first_name," ",null===e||void 0===e||null===(r=e.user_data)||void 0===r?void 0:r.last_name]}),(0,j.jsx)("p",{className:"mb-0 fw-normal",children:null===e||void 0===e?void 0:e.text})]}),(0,j.jsx)("span",{className:"comment-time fw-normal",children:v()("".concat(null===e||void 0===e?void 0:e.created_on)).format("DD-MMM")})]})]},n)}))}():(0,j.jsx)("p",{className:"text-center",children:"No comments yet!"})}),O&&(0,j.jsx)("form",{onSubmit:T,children:(0,j.jsxs)(f.cw,{className:"typing-area d-flex justify-content-between align-items-center start-0 bottom-0",children:[(0,j.jsx)("input",{className:"form-control",type:"text",name:"text",ref:E,placeholder:"Write here..",onChange:function(e){return function(e){var n=e.target.value;y(n)}(e)}}),(0,j.jsx)(f.zx,{disabled:0===(null===k||void 0===k?void 0:k.length),className:"send-btn shadow-none border-0 position-absolute end-0 pe-3",children:(0,j.jsx)(h.JO,{icon:"bi:send",color:0===(null===k||void 0===k?void 0:k.length)?"#ccc":"#900"})})]})})]})})}}}]);
//# sourceMappingURL=7707.4dd2bcfa.chunk.js.map